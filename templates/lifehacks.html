{% extends "includes/base.html" %}

{% block title %}–õ–∞–π—Ñ—Ö–∞–∫–∏ –∏ —Ñ–∞–∫—Ç—ã - –¶–µ–Ω—Ç—Ä –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ï–ì–≠ –û–ì–≠{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Content -->
    <div class="page-content lifehacks-page">
        <h1 class="page-title">–õ–∞–π—Ñ—Ö–∞–∫–∏ –∏ —Ñ–∞–∫—Ç—ã</h1>
        
        <div class="lifehacks-container">
            <!-- Card Container -->
            <div class="card-container">
                <div class="lifehack-card" id="lifehackCard">
                    <div class="card-header">
                        <span class="card-type" id="cardType">
                            <span class="type-icon">üí°</span>
                            <span class="type-text">–õ–∞–π—Ñ—Ö–∞–∫</span>
                        </span>
                        <span class="card-category" id="cardCategory">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</span>
                    </div>
                    <h2 class="card-title" id="cardTitle">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                    <p class="card-content" id="cardContent">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</p>
                </div>
                
                <!-- Progress Indicator -->
                <div class="progress-indicator">
                    <span id="currentIndex">1</span> / <span id="totalCount">30</span>
                </div>
                
                <!-- Action Buttons -->
                <div class="card-actions">
                    <button class="action-btn action-btn-secondary" id="prevBtn" disabled>
                        ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button class="action-btn action-btn-primary" id="nextBtn">
                        –°–ª–µ–¥—É—é—â–∏–π ‚Üí
                    </button>
                </div>
                
                <!-- Swipe Hint -->
                <div class="swipe-hint">
                    <span>–°–≤–∞–π–ø–Ω–∏—Ç–µ –≤–ª–µ–≤–æ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∫–∞—Ä—Ç–æ—á–∫–∏ ‚Üí</span>
                </div>
            </div>
        </div>
        
        <!-- Back Button -->
        <div class="back-btn-container">
            <a href="{{ url_for('index') }}" class="back-btn">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
    </div>
    
    <!-- Background Elements -->
    <div class="background-elements">
        <!-- Keyboard Keys -->
        <div class="key key-1">√Ñ</div>
        <div class="key key-2">7</div>
        <div class="key key-3">8</div>
        <div class="key key-4">√ú</div>
        <div class="key key-5">U</div>
        <div class="key key-6">Q</div>
        <div class="key key-7">X</div>
        <div class="key key-8">Z</div>
        <div class="key key-9">5</div>
        <div class="key key-10">Y</div>
        
        <!-- Geometric Shapes -->
        <div class="shape shape-circle shape-1"></div>
        <div class="shape shape-square shape-2"></div>
        <div class="shape shape-triangle shape-3"></div>
        <div class="shape shape-hexagon shape-4"></div>
        <div class="shape shape-circle shape-5"></div>
        <div class="shape shape-square shape-6"></div>
        <div class="shape shape-triangle shape-7"></div>
        <div class="shape shape-hexagon shape-8"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Lifehacks data
    let lifehacksData = [];
    let currentIndex = 0;
    let isAnimating = false;
    
    // DOM Elements
    const card = document.getElementById('lifehackCard');
    const cardType = document.getElementById('cardType');
    const cardCategory = document.getElementById('cardCategory');
    const cardTitle = document.getElementById('cardTitle');
    const cardContent = document.getElementById('cardContent');
    const currentIndexEl = document.getElementById('currentIndex');
    const totalCountEl = document.getElementById('totalCount');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    
    // Type mappings
    const typeConfig = {
        'lifehack': {
            icon: 'üí°',
            text: '–õ–∞–π—Ñ—Ö–∞–∫',
            class: 'type-lifehack'
        },
        'fact': {
            icon: 'üìö',
            text: '–§–∞–∫—Ç',
            class: 'type-fact'
        }
    };
    
    const categoryNames = {
        'preparation': '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞',
        'study': '–£—á—ë–±–∞',
        'exam': '–ù–∞ —ç–∫–∑–∞–º–µ–Ω–µ',
        'health': '–ó–¥–æ—Ä–æ–≤—å–µ',
        'logistics': '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è',
        'ege-history': '–ò—Å—Ç–æ—Ä–∏—è –ï–ì–≠',
        'statistics': '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
        'rules': '–ü—Ä–∞–≤–∏–ª–∞',
        'basics': '–û—Å–Ω–æ–≤—ã',
        'changes': '–ò–∑–º–µ–Ω–µ–Ω–∏—è',
        'structure': '–°—Ç—Ä—É–∫—Ç—É—Ä–∞',
        'admissions': '–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ'
    };
    
    // Initialize
    async function init() {
        try {
            const response = await fetch('/api/lifehacks');
            const result = await response.json();
            if (result.success) {
                lifehacksData = result.data;
                totalCountEl.textContent = lifehacksData.length;
                
                // Shuffle initially
                shuffleArray(lifehacksData);
                
                // Show first card
                showCard(0, false);
            } else {
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        } catch (error) {
            console.error('Error loading lifehacks:', error);
            showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
        }
    }
    
    // Show card with animation
    function showCard(index, animate = true) {
        if (isAnimating || index < 0 || index >= lifehacksData.length) return;
        
        isAnimating = true;
        const item = lifehacksData[index];
        
        // Update UI
        currentIndex = index;
        currentIndexEl.textContent = index + 1;
        
        // Update buttons state
        prevBtn.disabled = index === 0;
        nextBtn.disabled = index === lifehacksData.length - 1;
        
        // Update card content
        const typeInfo = typeConfig[item.type] || typeConfig.lifehack;
        
        // Remove old type class
        cardType.classList.remove('type-lifehack', 'type-fact');
        
        cardType.innerHTML = `
            <span class="type-icon">${typeInfo.icon}</span>
            <span class="type-text">${typeInfo.text}</span>
        `;
        cardType.classList.add(typeInfo.class);
        
        cardCategory.textContent = categoryNames[item.category] || item.category;
        cardTitle.textContent = item.title;
        cardContent.textContent = item.content;
        
        if (animate) {
            // Animate out
            card.style.animation = 'slideOutLeft 0.3s ease forwards';
            
            setTimeout(() => {
                // Animate in
                card.style.animation = 'slideInRight 0.3s ease forwards';
                card.style.opacity = '1';
                card.style.transform = 'translateX(0)';
                
                setTimeout(() => {
                    isAnimating = false;
                }, 300);
            }, 300);
        } else {
            isAnimating = false;
        }
    }
    
    // Show error
    function showError(message) {
        cardTitle.textContent = '–û—à–∏–±–∫–∞';
        cardContent.textContent = message;
    }
    
    // Fisher-Yates shuffle
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }
    
    // Event Listeners
    prevBtn.addEventListener('click', () => {
        if (currentIndex > 0) {
            showCard(currentIndex - 1);
        }
    });
    
    nextBtn.addEventListener('click', () => {
        if (currentIndex < lifehacksData.length - 1) {
            showCard(currentIndex + 1);
        }
    });
    
    // Touch handling for swipe
    let touchStartX = 0;
    let touchEndX = 0;
    const minSwipeDistance = 50;
    
    card.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });
    
    card.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    }, { passive: true });
    
    function handleSwipe() {
        const swipeDistance = touchEndX - touchStartX;
        
        // Swipe left - next card
        if (swipeDistance < -minSwipeDistance && currentIndex < lifehacksData.length - 1) {
            showCard(currentIndex + 1);
        }
        // Swipe right - previous card
        else if (swipeDistance > minSwipeDistance && currentIndex > 0) {
            showCard(currentIndex - 1);
        }
    }
    
    // Keyboard support
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' && currentIndex > 0) {
            showCard(currentIndex - 1);
        } else if (e.key === 'ArrowRight' && currentIndex < lifehacksData.length - 1) {
            showCard(currentIndex + 1);
        }
    });
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', init);
</script>
{% endblock %}

