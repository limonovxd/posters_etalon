{% extends "includes/base.html" %}

{% block title %}–õ–∞–π—Ñ—Ö–∞–∫–∏ –∏ —Ñ–∞–∫—Ç—ã - –¶–µ–Ω—Ç—Ä –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ï–ì–≠ –û–ì–≠{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Content -->
    <div class="page-content lifehacks-page">
        <h1 class="page-title">–õ–∞–π—Ñ—Ö–∞–∫–∏ –∏ —Ñ–∞–∫—Ç—ã</h1>
        
        <div class="lifehacks-container">
            <!-- Card Container -->
            <div class="card-container">
                <div class="lifehack-card" id="lifehackCard">
                    <div class="card-header">
                        <span class="card-type" id="cardType">
                            <span class="type-icon">üí°</span>
                            <span class="type-text">–õ–∞–π—Ñ—Ö–∞–∫</span>
                        </span>
                        <span class="card-category" id="cardCategory">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</span>
                    </div>
                    <h2 class="card-title" id="cardTitle">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                    <p class="card-content" id="cardContent">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...</p>
                </div>
                
                <!-- Progress Indicator -->
                <div class="progress-indicator">
                    <span id="currentIndex">1</span> / <span id="totalCount">30</span>
                </div>
                
                <!-- Swipe Hint -->
                <div class="swipe-hint">
                    <span>–°–≤–∞–π–ø–Ω–∏—Ç–µ –≤–ª–µ–≤–æ –∏–ª–∏ –≤–ø—Ä–∞–≤–æ ‚Üê ‚Üí</span>
                </div>
            </div>
        </div>
        
        <!-- Back Button -->
        <div class="back-btn-container">
            <a href="{{ url_for('index') }}" class="back-btn">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    // Lifehacks data
    let lifehacksData = [];
    let currentIndex = 0;
    let isAnimating = false;
    
    // DOM Elements
    const card = document.getElementById('lifehackCard');
    const cardType = document.getElementById('cardType');
    const cardCategory = document.getElementById('cardCategory');
    const cardTitle = document.getElementById('cardTitle');
    const cardContent = document.getElementById('cardContent');
    const currentIndexEl = document.getElementById('currentIndex');
    const totalCountEl = document.getElementById('totalCount');
    
    // Type mappings
    const typeConfig = {
        'lifehack': {
            icon: 'üí°',
            text: '–õ–∞–π—Ñ—Ö–∞–∫',
            class: 'type-lifehack'
        },
        'fact': {
            icon: 'üìö',
            text: '–§–∞–∫—Ç',
            class: 'type-fact'
        }
    };
    
    const categoryNames = {
        'preparation': '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞',
        'study': '–£—á—ë–±–∞',
        'exam': '–ù–∞ —ç–∫–∑–∞–º–µ–Ω–µ',
        'health': '–ó–¥–æ—Ä–æ–≤—å–µ',
        'logistics': '–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è',
        'ege-history': '–ò—Å—Ç–æ—Ä–∏—è –ï–ì–≠',
        'statistics': '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
        'rules': '–ü—Ä–∞–≤–∏–ª–∞',
        'basics': '–û—Å–Ω–æ–≤—ã',
        'changes': '–ò–∑–º–µ–Ω–µ–Ω–∏—è',
        'structure': '–°—Ç—Ä—É–∫—Ç—É—Ä–∞',
        'admissions': '–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ'
    };
    
    // Initialize
    async function init() {
        try {
            const response = await fetch('/api/lifehacks');
            const result = await response.json();
            if (result.success) {
                lifehacksData = result.data;
                totalCountEl.textContent = lifehacksData.length;
                
                // Shuffle initially
                shuffleArray(lifehacksData);
                
                // Show first card
                showCard(0, false);
            } else {
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        } catch (error) {
            console.error('Error loading lifehacks:', error);
            showError('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
        }
    }
    
    // Show card with smooth animation
    function showCard(index, animate = true, direction = 'next') {
        if (isAnimating || index < 0 || index >= lifehacksData.length) return;
        
        isAnimating = true;
        const item = lifehacksData[index];
        
        // Update UI
        currentIndex = index;
        currentIndexEl.textContent = index + 1;
        
        // Update card content
        const typeInfo = typeConfig[item.type] || typeConfig.lifehack;
        
        // Remove old type class
        cardType.classList.remove('type-lifehack', 'type-fact');
        
        cardType.innerHTML = `
            <span class="type-icon">${typeInfo.icon}</span>
            <span class="type-text">${typeInfo.text}</span>
        `;
        cardType.classList.add(typeInfo.class);
        
        cardCategory.textContent = categoryNames[item.category] || item.category;
        cardTitle.textContent = item.title;
        cardContent.textContent = item.content;
        
        if (animate) {
            // Determine animation based on direction
            const outAnimation = direction === 'next' ? 'slideOutLeft 0.25s ease-out forwards' : 'slideOutRight 0.25s ease-out forwards';
            const inAnimation = direction === 'next' ? 'slideInRight 0.25s ease-out forwards' : 'slideInLeft 0.25s ease-out forwards';
            
            // Animate out
            card.style.animation = outAnimation;
            
            setTimeout(() => {
                // Reset animation and show content immediately
                card.style.animation = 'none';
                card.offsetHeight; // Trigger reflow
                card.style.opacity = '1';
                card.style.transform = 'translate3d(0, 0, 0)';
                
                // Animate in
                card.style.animation = inAnimation;
                
                setTimeout(() => {
                    // Clean up animation styles
                    card.style.animation = 'none';
                    isAnimating = false;
                }, 250);
            }, 250);
        } else {
            isAnimating = false;
        }
    }
    
    // Show error
    function showError(message) {
        cardTitle.textContent = '–û—à–∏–±–∫–∞';
        cardContent.textContent = message;
    }
    
    // Fisher-Yates shuffle
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }
    
    // Touch handling for swipe
    let touchStartX = 0;
    let touchEndX = 0;
    const minSwipeDistance = 50;
    
    // Use passive: false to allow preventDefault
    card.addEventListener('touchstart', handleTouchStart, { passive: false });
    card.addEventListener('touchmove', handleTouchMove, { passive: false });
    card.addEventListener('touchend', handleTouchEnd, { passive: false });
    
    function handleTouchStart(e) {
        touchStartX = e.changedTouches[0].screenX;
        // Prevent default only if this looks like a horizontal gesture
        // We'll check direction in touchmove
    }
    
    function handleTouchMove(e) {
        const currentX = e.changedTouches[0].screenX;
        const deltaX = currentX - touchStartX;
        
        // If horizontal movement is significant, prevent vertical scroll
        if (Math.abs(deltaX) > 10) {
            e.preventDefault();
        }
    }
    
    function handleTouchEnd(e) {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    }
    
    function handleSwipe() {
        const swipeDistance = touchEndX - touchStartX;
        
        // Swipe left - next card
        if (swipeDistance < -minSwipeDistance && currentIndex < lifehacksData.length - 1) {
            showCard(currentIndex + 1, true, 'next');
        }
        // Swipe right - previous card
        else if (swipeDistance > minSwipeDistance && currentIndex > 0) {
            showCard(currentIndex - 1, true, 'prev');
        }
    }
    
    // Keyboard support
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' && currentIndex > 0) {
            showCard(currentIndex - 1, true, 'prev');
        } else if (e.key === 'ArrowRight' && currentIndex < lifehacksData.length - 1) {
            showCard(currentIndex + 1, true, 'next');
        }
    });
    
    // Initialize on page load
    document.addEventListener('DOMContentLoaded', init);
</script>
{% endblock %}

